{"ast":null,"code":"import React,{useState}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{sendOTP,verifyOTP,getCSRFToken}from'../auth/AuthUtils';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_URL||\"http://127.0.0.1:8000\";const Signup=()=>{const[userInfo,setUserInfo]=useState({name:'',phone:'',email:'',password:''});const[otp,setOTP]=useState('');const[otpSent,setOtpSent]=useState(false);const[verified,setVerified]=useState(false);const[errorMessage,setErrorMessage]=useState(null);const navigate=useNavigate();const handleChange=e=>{const{name,value}=e.target;setUserInfo({...userInfo,[name]:value});};const handleSendOTP=async()=>{try{const response=await sendOTP(userInfo.phone);if(response.success){alert('OTP sent successfully!');setOtpSent(true);}else{alert('Failed to send OTP');}}catch(error){alert('Error sending OTP');}};const handleVerifyOTP=async()=>{try{const response=await verifyOTP(userInfo.phone,otp);if(response.success){alert('OTP verified successfully!');setVerified(true);}else{alert('Invalid OTP');}}catch(error){alert('Error verifying OTP');}};const handleSignup=async()=>{console.log('üöÄ Signup button clicked! Attempting to call API...');if(!verified){alert('‚ö†Ô∏è Please verify your OTP first.');return;}console.log('‚úÖ Proceeding with signup:',userInfo);const csrfToken=await getCSRFToken();if(!csrfToken){console.error('‚ùå CSRF Token is missing. Ensure backend sends CSRF cookie.');alert('CSRF Token missing. Please refresh and try again.');return;}try{const response=await axios.post(`${API_BASE_URL}/api/auth/signup/`,{name:userInfo.name,// Must match backend (username in Django)\nphone:userInfo.phone,// Must match backend (phone_number in Django)\nemail:userInfo.email,password:userInfo.password},{headers:{'Content-Type':'application/json','X-CSRFToken':csrfToken},withCredentials:true});console.log('üéâ API Response:',response.data);if(response.data.success){alert('‚úÖ Signup successful! Redirecting to products...');navigate('/products');}else{setErrorMessage(response.data.message);}}catch(error){var _error$response,_error$response2;console.error('üî• API request failed:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error);setErrorMessage(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data.message)||'‚ùå Error during signup. Check console.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"form-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Signup\"}),errorMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[\"\\u274C \",errorMessage,errorMessage.includes('already exists')&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/login'),className:\"redirect-btn\",children:\"Go to Login\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",placeholder:\"Name\",value:userInfo.name,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email\",value:userInfo.email,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"phone\",placeholder:\"Phone Number\",value:userInfo.phone,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",placeholder:\"Password\",value:userInfo.password,onChange:handleChange,required:true}),!otpSent?/*#__PURE__*/_jsx(\"button\",{onClick:handleSendOTP,children:\"Send OTP\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter OTP\",value:otp,onChange:e=>setOTP(e.target.value),required:true}),/*#__PURE__*/_jsx(\"button\",{onClick:handleVerifyOTP,children:\"Verify OTP\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSignup,disabled:!verified,children:\"Signup\"})]});};export default Signup;","map":{"version":3,"names":["React","useState","axios","useNavigate","sendOTP","verifyOTP","getCSRFToken","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE_URL","process","env","REACT_APP_API_URL","Signup","userInfo","setUserInfo","name","phone","email","password","otp","setOTP","otpSent","setOtpSent","verified","setVerified","errorMessage","setErrorMessage","navigate","handleChange","e","value","target","handleSendOTP","response","success","alert","error","handleVerifyOTP","handleSignup","console","log","csrfToken","post","headers","withCredentials","data","message","_error$response","_error$response2","className","children","includes","onClick","type","placeholder","onChange","required","disabled"],"sources":["/Users/kunwarkanhaiyakamlakantpandey/Downloads/project of harit kranti/harit_aahar1/Harit_Aahar/frontend/src/auth/Signup.js"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom'; \n\nimport { sendOTP, verifyOTP, getCSRFToken } from '../auth/AuthUtils';\nconst API_BASE_URL = process.env.REACT_APP_API_URL || \"http://127.0.0.1:8000\";\nconst Signup = () => {\n  const [userInfo, setUserInfo] = useState({ name: '', phone: '', email: '', password: '' });\n  const [otp, setOTP] = useState('');\n  const [otpSent, setOtpSent] = useState(false);\n  const [verified, setVerified] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(null); \n  const navigate = useNavigate(); \n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setUserInfo({ ...userInfo, [name]: value });\n  };\n\n  const handleSendOTP = async () => {\n    try {\n      const response = await sendOTP(userInfo.phone);\n      if (response.success) {\n        alert('OTP sent successfully!');\n        setOtpSent(true);\n      } else {\n        alert('Failed to send OTP');\n      }\n    } catch (error) {\n      alert('Error sending OTP');\n    }\n  };\n\n  const handleVerifyOTP = async () => {\n    try {\n      const response = await verifyOTP(userInfo.phone, otp);\n      if (response.success) {\n        alert('OTP verified successfully!');\n        setVerified(true);\n      } else {\n        alert('Invalid OTP');\n      }\n    } catch (error) {\n      alert('Error verifying OTP');\n    }\n  };\n\n  const handleSignup = async () => {\n    console.log('üöÄ Signup button clicked! Attempting to call API...');\n    \n  \n    if (!verified) {\n      alert('‚ö†Ô∏è Please verify your OTP first.');\n      return;\n    }\n  \n    console.log('‚úÖ Proceeding with signup:', userInfo);\n  \n    const csrfToken = await getCSRFToken();\n    if (!csrfToken) {\n      console.error('‚ùå CSRF Token is missing. Ensure backend sends CSRF cookie.');\n      alert('CSRF Token missing. Please refresh and try again.');\n      return;\n    }\n  \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/signup/`, \n        {\n          name: userInfo.name,  // Must match backend (username in Django)\n          phone: userInfo.phone,  // Must match backend (phone_number in Django)\n          email: userInfo.email,\n          password: userInfo.password,\n        }, \n        {\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrfToken,\n          },\n          withCredentials: true,\n        }\n      );\n  \n      console.log('üéâ API Response:', response.data);\n  \n      if (response.data.success) {\n        \n        alert('‚úÖ Signup successful! Redirecting to products...');\n        navigate('/products'); \n       \n\n      } else {\n        setErrorMessage(response.data.message); \n      }\n    } catch (error) {\n      console.error('üî• API request failed:', error.response?.data || error);\n      setErrorMessage(error.response?.data.message || '‚ùå Error during signup. Check console.');\n    \n    }\n  };\n\n  \n\n\n\n  \n  return (\n    <div className=\"form-container\">\n      <h2>Signup</h2>\n      {errorMessage && (\n        <div className=\"error-message\">\n          ‚ùå {errorMessage}\n          {errorMessage.includes('already exists') && (\n            <button onClick={() => navigate('/login')} className=\"redirect-btn\">\n              Go to Login\n            </button>\n          )}\n        </div>\n      )}\n      \n      <input type=\"text\" name=\"name\" placeholder=\"Name\" value={userInfo.name} onChange={handleChange} required />\n      <input type=\"email\" name=\"email\" placeholder=\"Email\" value={userInfo.email} onChange={handleChange} required />\n      <input type=\"tel\" name=\"phone\" placeholder=\"Phone Number\" value={userInfo.phone} onChange={handleChange} required />\n      <input type=\"password\" name=\"password\" placeholder=\"Password\" value={userInfo.password} onChange={handleChange} required />\n      \n      {!otpSent ? (\n        <button onClick={handleSendOTP}>Send OTP</button>\n      ) : (\n        <>\n          <input type=\"text\" placeholder=\"Enter OTP\" value={otp} onChange={(e) => setOTP(e.target.value)} required />\n          <button onClick={handleVerifyOTP}>Verify OTP</button>\n        </>\n      )}\n\n      <button onClick={handleSignup} disabled={!verified}>Signup</button>\n    </div>\n  );\n};\n\nexport default Signup;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}