{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{getCSRFToken}from\"../auth/AuthUtils\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_URL||\"http://localhost:8000\";const Profile=()=>{const[profile,setProfile]=useState(null);const navigate=useNavigate();useEffect(()=>{fetchProfile();},[]);const fetchProfile=async()=>{console.log(\"ðŸ”„ Fetching profile...\");try{const csrfToken=await getCSRFToken();// Ensure CSRF Token is awaited\nconst authToken=localStorage.getItem(\"authToken\");console.log(\"âœ… CSRF Token:\",csrfToken);console.log(\"âœ… CSRF Token:\",authToken);const response=await axios.get(`${API_BASE_URL}/api/auth/profile/`,{withCredentials:true,headers:{\"X-CSRFToken\":csrfToken,// CSRF token\n\"Authorization\":authToken?`Token ${authToken}`:\"\",// Auth token if available\n\"Content-Type\":\"application/json\"}});console.log(\"âœ… Profile Data:\",response.data);setProfile(response.data);}catch(error){var _error$response;console.error(\"ðŸš¨ Error fetching profile:\",((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error);alert(\"Error loading profile. Redirecting to login...\");navigate(\"/login\");// Redirect to login if unauthorized\n}};const handleLogout=()=>{localStorage.removeItem(\"authToken\");localStorage.removeItem(\"user\");window.dispatchEvent(new Event(\"storage\"));// notify other components if needed\nnavigate(\"/login\");};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"User Profile\"}),profile?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",profile.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",profile.email]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Phone:\"}),\" \",profile.phone_number]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Orders\"}),profile.orders.length>0?/*#__PURE__*/_jsx(\"ul\",{children:profile.orders.map(order=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order ID:\"}),\" \",order.id]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Amount:\"}),\" \\u20B9\",order.total_amount]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",order.status]})]},order.id))}):/*#__PURE__*/_jsx(\"p\",{children:\"No orders found.\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Addresses\"}),profile.addresses&&profile.addresses.length>0?/*#__PURE__*/_jsx(\"ul\",{children:profile.addresses.map(address=>/*#__PURE__*/_jsxs(\"li\",{children:[address.address_line1,\", \",address.address_line2,\", \",address.city,\", \",address.state,\", \",address.country,\" - \",address.postal_code,/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,children:\"Logout\"})]},address.id))}):/*#__PURE__*/_jsxs(\"p\",{children:[\"No addresses found. \",/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/add-address\"),children:\"Add Address\"})]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Loading profile...\"})]});};export default Profile;","map":{"version":3,"names":["React","useEffect","useState","axios","useNavigate","getCSRFToken","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","process","env","REACT_APP_API_URL","Profile","profile","setProfile","navigate","fetchProfile","console","log","csrfToken","authToken","localStorage","getItem","response","get","withCredentials","headers","data","error","_error$response","alert","handleLogout","removeItem","window","dispatchEvent","Event","children","name","email","phone_number","orders","length","map","order","id","total_amount","status","addresses","address","address_line1","address_line2","city","state","country","postal_code","onClick"],"sources":["/Users/kunwarkanhaiyakamlakantpandey/Downloads/project of harit kranti/harit_aahar1/Harit_Aahar/frontend/src/pages/Profile.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport { getCSRFToken } from \"../auth/AuthUtils\";\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || \"http://localhost:8000\"; \nconst Profile = () => {\n  const [profile, setProfile] = useState(null);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetchProfile();\n  }, []);\n\n  const fetchProfile = async () => {\n    console.log(\"ðŸ”„ Fetching profile...\");\n\n    try {\n      const csrfToken = await getCSRFToken();  // Ensure CSRF Token is awaited\n      const authToken = localStorage.getItem(\"authToken\"); \n      console.log(\"âœ… CSRF Token:\", csrfToken);\n      console.log(\"âœ… CSRF Token:\", authToken);\n\n      const response = await axios.get(`${API_BASE_URL}/api/auth/profile/`, {\n      withCredentials: true,  \n      headers: {\n        \"X-CSRFToken\": csrfToken,  // CSRF token\n        \"Authorization\": authToken ? `Token ${authToken}` : \"\",  // Auth token if available\n        \"Content-Type\": \"application/json\",\n\n        },\n        \n      });\n\n      console.log(\"âœ… Profile Data:\", response.data);\n      setProfile(response.data);\n    } catch (error) {\n      console.error(\"ðŸš¨ Error fetching profile:\", error.response?.data || error);\n      alert(\"Error loading profile. Redirecting to login...\");\n      navigate(\"/login\");  // Redirect to login if unauthorized\n    }\n  };\n  const handleLogout = () => {\n    localStorage.removeItem(\"authToken\");\n    localStorage.removeItem(\"user\");\n    window.dispatchEvent(new Event(\"storage\")); // notify other components if needed\n    navigate(\"/login\");\n  };\n\n  \n\n  return (\n    <div>\n      <h1>User Profile</h1>\n      {profile ? (\n        <div>\n          <p><strong>Name:</strong> {profile.name}</p>\n          <p><strong>Email:</strong> {profile.email}</p>\n          <p><strong>Phone:</strong> {profile.phone_number}</p>\n\n          <h2>Orders</h2>\n          {profile.orders.length > 0 ? (\n            <ul>\n              {profile.orders.map((order) => (\n                <li key={order.id}>\n                  <p><strong>Order ID:</strong> {order.id}</p>\n                  <p><strong>Amount:</strong> â‚¹{order.total_amount}</p>\n                  <p><strong>Status:</strong> {order.status}</p>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p>No orders found.</p>\n          )}\n\n<h3>Addresses</h3>\n{profile.addresses && profile.addresses.length > 0 ? (\n  <ul>\n    {profile.addresses.map((address) => (\n      <li key={address.id}>\n        {address.address_line1}, {address.address_line2}, {address.city}, {address.state}, {address.country} - {address.postal_code}\n         <button onClick={handleLogout}>Logout</button>\n\n      </li>\n    ))}\n  </ul>\n) : (\n  <p>No addresses found. <button onClick={() => navigate(\"/add-address\")}>Add Address</button></p>\n)}\n\n        </div>\n      ) : (\n        <p>Loading profile...</p>\n      )}\n    </div>\n  );\n};\n\nexport default Profile;\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,YAAY,KAAQ,mBAAmB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEjD,KAAM,CAAAC,YAAY,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,CAC7E,KAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CACpB,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAAe,QAAQ,CAAGb,WAAW,CAAC,CAAC,CAE9BH,SAAS,CAAC,IAAM,CACdiB,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAA,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/BC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC,CAErC,GAAI,CACF,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAhB,YAAY,CAAC,CAAC,CAAG;AACzC,KAAM,CAAAiB,SAAS,CAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CACnDL,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEC,SAAS,CAAC,CACvCF,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEE,SAAS,CAAC,CAEvC,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAtB,KAAK,CAACuB,GAAG,CAAC,GAAGhB,YAAY,oBAAoB,CAAE,CACtEiB,eAAe,CAAE,IAAI,CACrBC,OAAO,CAAE,CACP,aAAa,CAAEP,SAAS,CAAG;AAC3B,eAAe,CAAEC,SAAS,CAAG,SAASA,SAAS,EAAE,CAAG,EAAE,CAAG;AACzD,cAAc,CAAE,kBAEhB,CAEF,CAAC,CAAC,CAEFH,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEK,QAAQ,CAACI,IAAI,CAAC,CAC7Cb,UAAU,CAACS,QAAQ,CAACI,IAAI,CAAC,CAC3B,CAAE,MAAOC,KAAK,CAAE,KAAAC,eAAA,CACdZ,OAAO,CAACW,KAAK,CAAC,4BAA4B,CAAE,EAAAC,eAAA,CAAAD,KAAK,CAACL,QAAQ,UAAAM,eAAA,iBAAdA,eAAA,CAAgBF,IAAI,GAAIC,KAAK,CAAC,CAC1EE,KAAK,CAAC,gDAAgD,CAAC,CACvDf,QAAQ,CAAC,QAAQ,CAAC,CAAG;AACvB,CACF,CAAC,CACD,KAAM,CAAAgB,YAAY,CAAGA,CAAA,GAAM,CACzBV,YAAY,CAACW,UAAU,CAAC,WAAW,CAAC,CACpCX,YAAY,CAACW,UAAU,CAAC,MAAM,CAAC,CAC/BC,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAE;AAC5CpB,QAAQ,CAAC,QAAQ,CAAC,CACpB,CAAC,CAID,mBACER,KAAA,QAAA6B,QAAA,eACE/B,IAAA,OAAA+B,QAAA,CAAI,cAAY,CAAI,CAAC,CACpBvB,OAAO,cACNN,KAAA,QAAA6B,QAAA,eACE7B,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,OAAK,CAAQ,CAAC,IAAC,CAACvB,OAAO,CAACwB,IAAI,EAAI,CAAC,cAC5C9B,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,QAAM,CAAQ,CAAC,IAAC,CAACvB,OAAO,CAACyB,KAAK,EAAI,CAAC,cAC9C/B,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,QAAM,CAAQ,CAAC,IAAC,CAACvB,OAAO,CAAC0B,YAAY,EAAI,CAAC,cAErDlC,IAAA,OAAA+B,QAAA,CAAI,QAAM,CAAI,CAAC,CACdvB,OAAO,CAAC2B,MAAM,CAACC,MAAM,CAAG,CAAC,cACxBpC,IAAA,OAAA+B,QAAA,CACGvB,OAAO,CAAC2B,MAAM,CAACE,GAAG,CAAEC,KAAK,eACxBpC,KAAA,OAAA6B,QAAA,eACE7B,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,WAAS,CAAQ,CAAC,IAAC,CAACO,KAAK,CAACC,EAAE,EAAI,CAAC,cAC5CrC,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,SAAO,CAAQ,CAAC,UAAE,CAACO,KAAK,CAACE,YAAY,EAAI,CAAC,cACrDtC,KAAA,MAAA6B,QAAA,eAAG/B,IAAA,WAAA+B,QAAA,CAAQ,SAAO,CAAQ,CAAC,IAAC,CAACO,KAAK,CAACG,MAAM,EAAI,CAAC,GAHvCH,KAAK,CAACC,EAIX,CACL,CAAC,CACA,CAAC,cAELvC,IAAA,MAAA+B,QAAA,CAAG,kBAAgB,CAAG,CACvB,cAEX/B,IAAA,OAAA+B,QAAA,CAAI,WAAS,CAAI,CAAC,CACjBvB,OAAO,CAACkC,SAAS,EAAIlC,OAAO,CAACkC,SAAS,CAACN,MAAM,CAAG,CAAC,cAChDpC,IAAA,OAAA+B,QAAA,CACGvB,OAAO,CAACkC,SAAS,CAACL,GAAG,CAAEM,OAAO,eAC7BzC,KAAA,OAAA6B,QAAA,EACGY,OAAO,CAACC,aAAa,CAAC,IAAE,CAACD,OAAO,CAACE,aAAa,CAAC,IAAE,CAACF,OAAO,CAACG,IAAI,CAAC,IAAE,CAACH,OAAO,CAACI,KAAK,CAAC,IAAE,CAACJ,OAAO,CAACK,OAAO,CAAC,KAAG,CAACL,OAAO,CAACM,WAAW,cAC1HjD,IAAA,WAAQkD,OAAO,CAAExB,YAAa,CAAAK,QAAA,CAAC,QAAM,CAAQ,CAAC,GAFxCY,OAAO,CAACJ,EAIb,CACL,CAAC,CACA,CAAC,cAELrC,KAAA,MAAA6B,QAAA,EAAG,sBAAoB,cAAA/B,IAAA,WAAQkD,OAAO,CAAEA,CAAA,GAAMxC,QAAQ,CAAC,cAAc,CAAE,CAAAqB,QAAA,CAAC,aAAW,CAAQ,CAAC,EAAG,CAChG,EAEY,CAAC,cAEN/B,IAAA,MAAA+B,QAAA,CAAG,oBAAkB,CAAG,CACzB,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAAxB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}