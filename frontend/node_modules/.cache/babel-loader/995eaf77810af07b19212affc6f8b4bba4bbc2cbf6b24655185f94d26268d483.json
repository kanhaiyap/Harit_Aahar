{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocation}from'react-router-dom';import'../assets/styles/style.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_URL;console.log(API_BASE_URL);const Products=()=>{const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const location=useLocation();// To access the search query from the URL\nuseEffect(()=>{fetch(`${API_BASE_URL}/api/products/`).then(response=>response.json()).then(data=>{setProducts(data);handleSearch(data);// Apply the search filter when products are fetched\n}).catch(error=>console.error('Error fetching products:',error));},[]);useEffect(()=>{handleSearch(products);// Re-run the filter when the search query changes\n},[location.search]);useEffect(()=>{fetch(\"/api/categories/\")// ✅ Fetch categories (each contains products)\n.then(response=>response.json()).then(data=>{console.log(\"✅ API Response:\",data);applyFilters(data);}).catch(error=>console.error(\"❌ Error fetching products:\",error));},[location.search]);const applyFilters=categories=>{var _queryParams$get,_queryParams$get2;const queryParams=new URLSearchParams(location.search);const selectedCategory=((_queryParams$get=queryParams.get(\"category\"))===null||_queryParams$get===void 0?void 0:_queryParams$get.toLowerCase())||\"\";const searchQuery=((_queryParams$get2=queryParams.get(\"search\"))===null||_queryParams$get2===void 0?void 0:_queryParams$get2.toLowerCase())||\"\";let filtered=categories.flatMap(cat=>cat.products);// ✅ Start with all products\n// ✅ If a category is selected, filter by category name\nif(selectedCategory){const matchedCategory=categories.find(cat=>cat.name.toLowerCase()===selectedCategory);if(matchedCategory){console.log(\"✅ Matched Category:\",matchedCategory.name);filtered=matchedCategory.products;}else{console.warn(\"❌ No matching category found!\");filtered=[];// If category not found, show no products\n}}// ✅ Apply search filter\nif(searchQuery){filtered=filtered.filter(product=>product.name.toLowerCase().includes(searchQuery)||product.description.toLowerCase().includes(searchQuery)||product.brand.toLowerCase().includes(searchQuery));}setFilteredProducts(filtered);};const handleSearch=allProducts=>{var _queryParams$get3;const queryParams=new URLSearchParams(location.search);const searchQuery=((_queryParams$get3=queryParams.get('search'))===null||_queryParams$get3===void 0?void 0:_queryParams$get3.toLowerCase())||'';if(searchQuery){// Filter products based on search query\nconst matchingProducts=allProducts.filter(product=>product.name.toLowerCase().includes(searchQuery)||product.description.toLowerCase().includes(searchQuery)||product.brand.toLowerCase().includes(searchQuery));// Combine matching products first, followed by non-matching ones\nconst nonMatchingProducts=allProducts.filter(product=>!matchingProducts.includes(product));setFilteredProducts([...matchingProducts,...nonMatchingProducts]);}else{// If no search query, display all products\nsetFilteredProducts(allProducts);}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Our Products\"}),filteredProducts.length>0&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"ul\",{className:\"products-container\",children:filteredProducts.map((product,index)=>/*#__PURE__*/_jsxs(\"li\",{className:`product-box ${index===0?'highlight':''}`,children:[/*#__PURE__*/_jsx(\"img\",{src:`/images/products/${decodeURIComponent(product.image.split('/').pop()).replace(/\\s+/g,' ').trim()}`,alt:product.name.trim(),className:\"product-image\"}),/*#__PURE__*/_jsx(\"h2\",{children:product.name}),/*#__PURE__*/_jsx(\"p\",{children:product.description}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price:\"}),\" \\u20B9\",product.price]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.addToCart(product.id,product.name,product.price,product.image),children:\"Add to Cart\"})]},product.id))})}),filteredProducts.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"No matching products found. Showing all available products below:\"}),location.search.includes(\"category\")&&/*#__PURE__*/_jsxs(\"h3\",{className:\"text-center\",children:[\"Showing results for category:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:new URLSearchParams(location.search).get(\"category\")})]})]});};export default Products;","map":{"version":3,"names":["React","useState","useEffect","useLocation","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE_URL","process","env","REACT_APP_API_URL","console","log","Products","products","setProducts","filteredProducts","setFilteredProducts","location","fetch","then","response","json","data","handleSearch","catch","error","search","applyFilters","categories","_queryParams$get","_queryParams$get2","queryParams","URLSearchParams","selectedCategory","get","toLowerCase","searchQuery","filtered","flatMap","cat","matchedCategory","find","name","warn","filter","product","includes","description","brand","allProducts","_queryParams$get3","matchingProducts","nonMatchingProducts","children","length","className","map","index","src","decodeURIComponent","image","split","pop","replace","trim","alt","price","onClick","window","addToCart","id"],"sources":["/Users/kunwarkanhaiyakamlakantpandey/Downloads/project of harit kranti/harit_aahar1/Harit_Aahar/frontend/src/pages/Products.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport '../assets/styles/style.css';\nconst API_BASE_URL = process.env.REACT_APP_API_URL; \n\nconsole.log(API_BASE_URL)\nconst Products = () => {\n  const [products, setProducts] = useState([]);\n  const [filteredProducts, setFilteredProducts] = useState([]);\n  const location = useLocation();  // To access the search query from the URL\n\n  useEffect(() => {\n    fetch(`${API_BASE_URL}/api/products/`)\n      .then(response => response.json())\n      .then(data => {\n        setProducts(data);\n        handleSearch(data);  // Apply the search filter when products are fetched\n      })\n      .catch(error => console.error('Error fetching products:', error));\n  }, []);\n\n  useEffect(() => {\n    handleSearch(products);  // Re-run the filter when the search query changes\n  }, [location.search]);\n  useEffect(() => {\n    fetch(\"/api/categories/\") // ✅ Fetch categories (each contains products)\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"✅ API Response:\", data);\n        applyFilters(data);\n      })\n      .catch((error) => console.error(\"❌ Error fetching products:\", error));\n  }, [location.search]);\n  const applyFilters = (categories) => {\n    const queryParams = new URLSearchParams(location.search);\n    const selectedCategory = queryParams.get(\"category\")?.toLowerCase() || \"\";\n    const searchQuery = queryParams.get(\"search\")?.toLowerCase() || \"\";\n  \n    let filtered = categories.flatMap((cat) => cat.products); // ✅ Start with all products\n  \n    // ✅ If a category is selected, filter by category name\n    if (selectedCategory) {\n      const matchedCategory = categories.find(\n        (cat) => cat.name.toLowerCase() === selectedCategory\n      );\n  \n      if (matchedCategory) {\n        console.log(\"✅ Matched Category:\", matchedCategory.name);\n        filtered = matchedCategory.products;\n      } else {\n        console.warn(\"❌ No matching category found!\");\n        filtered = []; // If category not found, show no products\n      }\n    }\n  \n    // ✅ Apply search filter\n    if (searchQuery) {\n      filtered = filtered.filter(\n        (product) =>\n          product.name.toLowerCase().includes(searchQuery) ||\n          product.description.toLowerCase().includes(searchQuery) ||\n          product.brand.toLowerCase().includes(searchQuery)\n      );\n    }\n  \n    setFilteredProducts(filtered);\n  };\n  \n\n  const handleSearch = (allProducts) => {\n    const queryParams = new URLSearchParams(location.search);\n    const searchQuery = queryParams.get('search')?.toLowerCase() || '';\n\n    if (searchQuery) {\n      // Filter products based on search query\n      const matchingProducts = allProducts.filter(product =>\n        product.name.toLowerCase().includes(searchQuery) ||\n        product.description.toLowerCase().includes(searchQuery) ||\n        product.brand.toLowerCase().includes(searchQuery)\n      );\n\n      // Combine matching products first, followed by non-matching ones\n      const nonMatchingProducts = allProducts.filter(product =>\n        !matchingProducts.includes(product)\n      );\n\n      setFilteredProducts([...matchingProducts, ...nonMatchingProducts]);\n    } else {\n      // If no search query, display all products\n      setFilteredProducts(allProducts);\n    }\n  };\n\n  return (\n    <div>\n      <h1>Our Products</h1>\n\n      {/* Display a message if no matching products are found */}\n      {filteredProducts.length > 0 && (\n        <>\n          <ul className=\"products-container\">\n            {filteredProducts.map((product, index) => (\n              <li key={product.id} className={`product-box ${index === 0 ? 'highlight' : ''}`}>\n                <img\n  src={`/images/products/${decodeURIComponent(product.image.split('/').pop()).replace(/\\s+/g, ' ').trim()}`}\n  alt={product.name.trim()}\n  className=\"product-image\"\n/>\n\n                <h2>{product.name}</h2>\n                <p>{product.description}</p>\n                <p><strong>Price:</strong> ₹{product.price}</p>\n                <button onClick={() => window.addToCart(product.id, product.name, product.price, product.image)}>\n                  Add to Cart\n                </button>\n              </li>\n            ))}\n          </ul>\n        </>\n      )}\n\n      {/* Fallback when no matches are found */}\n      {filteredProducts.length === 0 && (\n        <p>No matching products found. Showing all available products below:</p>\n      )}\n\n      {/* Display selected category */}\n      {location.search.includes(\"category\") && (\n        <h3 className=\"text-center\">\n          Showing results for category:{\" \"}\n          <strong>{new URLSearchParams(location.search).get(\"category\")}</strong>\n        </h3>\n      )}\n\n      \n    </div>\n  );\n};\n\nexport default Products;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}